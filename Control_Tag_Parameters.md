# Modbus Control Tag (40100) Parameter Interface

`ModbusTCP_NewTags_260121.ino`의 **Control 태그(40100)**는 로봇의 동작을 제어하는 핵심 파라미터입니다. 이 태그에 입력할 수 있는 값은 크게 **특수 키워드**와 **단일 문자 명령**으로 나뉩니다.

---

## 1. 특수 키워드 명령 (Special Keywords)
문자열 전체가 정확히 일치해야 실행되는 고유 시퀀스 명령입니다.

| 파라미터 | 동작 설명 |
| :--- | :--- |
| **`MOVE`** | **자동 주행 시나리오 시작**: 엔코더 기반으로 약 4m 전진 후, 제자리에서 360도 회전하는 전체 시퀀스를 실행합니다. |
| **`x`** | **즉시 정지 (E-Stop)**: 현재 실행 중인 모든 시나리오와 모터 동작을 즉시 중단하고 상태를 `STOP`으로 변경합니다. |

---

## 2. 단일 문자 명령 (Single Character Commands)
키워드 외의 경우, 입력된 문자열의 **첫 번째 글자**만 추출하여 하위 제어 보드(Mega 2560)로 전송합니다.

### A. 수동 주행 제어 (Manual Driving)
| 파라미터 | 동작 내용 |
| :---: | :--- |
| **`w`** | 전진 (Forward) |
| **`s`** | 후진 (Backward) |
| **`a`** | 좌회전 (Turn Left) |
| **`d`** | 우회전 (Turn Right) |

### B. 주행 모드 전환 (Operation Modes)
| 파라미터 | 모드 명칭 | 동작 설명 |
| :---: | :--- | :--- |
| **`p`** | **PID 모드** | QTR 센서를 이용한 정밀 라인이탈 방지 주행 모드 활성화 |
| **`l`** | **Line 모드** | 일반 라인트레이싱 모드 활성화 |
| **`1`** | **Auto 모드** | 일정 간격으로 전진과 회전을 반복하며 탐색하는 모드 |
| **`2`** | **Station 모드** | **자동 스테이션 모드**: 라인을 따라가다 흰색 스테이션 감지 시 정지 및 컨베이어 작동 |

### C. 보조 장치 및 시스템 진단 (Aux & System)
| 파라미터 | 동작 설명 |
| :---: | :--- |
| **`h` / `j` / `k`** | **서보 / 신호 제어**: 컨베이어(7번 핀) 등 보조 장치의 동작 상태 제어 |
| **`c`** | **센서 체크**: 모터를 멈추고 QTR 센서 값을 시리얼로 모니터링하는 모드 토글 |
| **`m`** | **모터 테스트**: 좌/우 모터가 정상 방향으로 구동되는지 1초씩 순차 진단 |

---

## 💡 사용 가이드 및 주의사항
1. **대소문자 민감**: 제어 보드와의 통신 프로토콜에 따라 주행 명령(`w`, `a`, `s`, `d`)은 **소문자** 입력을 권장합니다.
2. **에지 트리거링 (Edge Triggering)**: 본 시스템은 `Control` 태그의 값이 **바뀌는 순간**에만 동작합니다. 동일한 명령을 다시 실행하려면 태그 값을 초기화(예: 빈 문자열 입력)한 후 다시 입력하십시오.
3. **상태 피드백**: 명령 수행 결과는 **State 태그(40200)**를 통해 `RUN` 또는 `STOP`으로 실시간 보고됩니다.
