if(!window.BOT_DETECTOR_LOADED){window.BOT_DETECTOR_LOADED=!0;class a{static moderateUrl="https://fd.cleantalk.org/api3.0/frontend_data";static endpoints={moderate:["frontend_data"]};static send(a,o,n=null){return new Promise((t,r)=>{let s;if(-1===this.endpoints.moderate.indexOf(a))r(new Error("Method name unknown. "+a));else{s=new URL("string"==typeof n?n:this.moderateUrl);let e=new XMLHttpRequest;e.open("POST",s),e.timeout=15e3,e.setRequestHeader("Content-Type","application/json"),o.method_name=a,e.send(JSON.stringify(o)),e.onload=()=>{t(e)},e.onerror=()=>{r(new Error("Connection error. "+s.toString()))}}})}}class b{constructor(){this.storageKey="bot_detector_cron_storage",this.cronEventName="cronHubEvent",this.tickStep=500,this.tickFirst=500,this.ticksCount=0,this.taskTemplate={firstRunOnStep:1,runEveryNStep:2,clientInfoGetter:"",event:"",log:{getter_last_call:0,getter_calls_count:0,custom_code_last_call:0,custom_code_calls_count:0},runCustomCode:""},this.initializeStorage(),this.scheduleTasks()}runService(){this.ticksCount=0,setTimeout(()=>{setInterval(()=>this.tick(),this.tickStep)},this.tickFirst)}tick(){this.ticksCount++,this.runCustomCode();var e=this.collectClientInfo();this.isClientInfoReady(e)&&botDetectorSendClientInfoToCloud(this.mergeClientInfo(e),this.cronEventName)}collectClientInfo(){var t,e,r=this.getStorage(),s={};for([t,e]of Object.entries(r))try{this.shouldRunTask(e)&&this.isValidGetter(e.clientInfoGetter)&&(s[t]=this[e.clientInfoGetter](),this.isClientInfoReady(s))&&(r[t].log.getter_last_call=Math.floor(Date.now()/1e3),r[t].log.getter_calls_count++,this.setStorage(r))}catch(e){console.error(`Error executing getter for event "${t}":`,e)}return s}runCustomCode(){var t,e,r=this.getStorage();for([t,e]of Object.entries(r))try{this.shouldRunTask(e)&&this.isValidCustomCode(e.runCustomCode)&&(this[e.runCustomCode](),r[t].log.custom_code_last_call=Math.floor(Date.now()/1e3),r[t].log.custom_code_calls_count++,this.setStorage(r))}catch(e){return console.error(`Error executing custom cron code for event "${t}":`,e),!1}return!0}isValidGetter(e){return"function"==typeof this[e]}isValidCustomCode(e){return"function"==typeof this[e]}shouldRunTask(e){return this.ticksCount>=e.firstRunOnStep&&this.ticksCount%e.runEveryNStep==0}isClientInfoReady(e){return e&&"object"==typeof e&&0<Object.keys(e).length&&Object.values(e).some(e=>e&&e.agent&&e.timestamp&&2<Object.keys(e).length)}mergeClientInfo(e){var t,r={};for(t of Object.values(e))for(var[s,a]of Object.entries(t))null===a?r[s]=null:r[s]=a;return r}initializeStorage(){this.setStorage({})}getStorage(){return e.get(this.storageKey)||{}}setStorage(t){t&&"object"==typeof t?e.set(this.storageKey,t):console.error("Invalid storage data format")}addTask(e,t,r,s,a=""){if("string"!=typeof e||""===e.trim())throw new Error("Invalid event name: must be a non-empty string");if(!a&&("string"!=typeof t||""===t.trim()))throw new Error("Invalid clientInfoGetter: must be a non-empty string");if(void 0!==r&&(!Number.isInteger(r)||r<0))throw new Error("firstRunOnStep must be a non-negative integer");if(void 0!==s&&(!Number.isInteger(s)||s<=0))throw new Error("runEveryNStep must be a positive integer");e={...this.taskTemplate,event:e.trim(),clientInfoGetter:t.trim(),firstRunOnStep:Number.isInteger(r)?r:this.taskTemplate.firstRunOnStep,runEveryNStep:Number.isInteger(s)?s:this.taskTemplate.runEveryNStep,runCustomCode:a};this.updateTaskInStorage(e)}updateTaskInStorage(e){var t=this.getStorage();t[e.event]=e,this.setStorage(t)}scheduleTasks(){this.addTask("send_typo_data","getTypoData",1,5),this.addTask("send_fingerprint_data","getFingerprint",1,5),this.addTask("process_ip_version_checks","",2,5,"customCodeIPVersionChecks"),this.addTask("send_pointer_data","getPointerData",3,5),this.addTask("send_scrolling_data","getScrollingParameters",3,5),this.addTask("send_ip_version_data","getIPVersionData",3,5)}getTypoData(){var e=botDetectorCreateClientInfo();if(document.typoData?.data)for(var t in document.typoData.data){t=document.typoData.data[t];if(0<t.lastKeyTimestamp&&t.lastKeyTimestamp>Date.now()-l){e.typo=document.typoData.data;break}}return e}getPointerData(){var t=botDetectorCreateClientInfo(),r=e.get("bot_detector_pointer_data")||0;return 0!==r&&r.length&&u.last_data_length!==r.length&&(t.pointer_data=r,u.send_on_stop_collect&&(u.last_data_length=r.length,u.send_on_stop_collect=!1,u.send_on_cron=!1),u.send_on_cron)&&(u.last_data_length=r.length),t}getFingerprint(){var t=botDetectorCreateClientInfo(),r=e.get("bot_detector_f_hash");return!1===r?.sent&&(r.sent=Math.floor(Date.now()/1e3),e.set("bot_detector_f_hash",r),t.f_hash_data=r),t}getScrollingParameters(){var t=botDetectorCreateClientInfo(),r=e.isSet("bot_detector_scrolling_additional")?e.get("bot_detector_scrolling_additional","value"):0;return 0!==r&&void 0!==r.length&&m.last_data_length!==r.length&&(t.scrolling_additional=r,m.last_data_length=r.length),t}getIPVersionData(){var t=botDetectorCreateClientInfo(),r=e.get("bot_detector_token_ip_version"),s=[];for(let e=0;e<r.length;e++)null!==r[e]&&r[e].hasOwnProperty("ipv4_reached")&&0!==r[e].ipv4_reached&&r[e].hasOwnProperty("ipv6_reached")&&0!==r[e].ipv6_reached&&r[e].hasOwnProperty("sent")&&0===r[e].sent&&(r[e].sent=Math.floor(Date.now()/1e3),s.push(r[e]));return 0<s.length&&(t.token_ip_version=s,e.set("bot_detector_token_ip_version",s)),t}customCodeIPVersionChecks(e){v.processIPVersionChecks()}}class c{allParams={};modules={};paramStatus={};paramEntropy={};paramCategory={};recommended=[];progress=0;totalSteps=150;keyMap={browser:"bwr",canvas:"cnv",display:"dsp",enhanced_crypto:"ecr",enhanced_css:"ecs",enhanced_engine:"een",enhanced_math:"emh",hardware:"hwr",media:"med",runtime:"rnt",system:"sys",webgl:"wgl",webgpu:"wgp"};async hashString(e){var t=new TextEncoder;return this.hashBytes(t.encode(String(e)))}async hashBytes(t){if(!window.crypto||!window.crypto.subtle||"function"!=typeof window.crypto.subtle.digest)return console.warn("BotDetector say: Web Crypto API not available, using fallback hash function"),this.simpleHash(t);try{var e=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(e)).map(e=>e.toString(16).padStart(2,"0")).join("")}catch(e){return console.warn("BotDetector say: Web Crypto API failed, using fallback hash function:",e.message),this.simpleHash(t)}}simpleHash(t){if(0===(t="string"!=typeof t?t.toString():t).length)return"0".repeat(64);let r=0;for(let e=0;e<t.length;e++){var s=t.charCodeAt(e);r=(r<<5)-r+s,r&=r}let a=Math.abs(r).toString(16).padStart(8,"0");for(let e=0;e<7;e++){var o=(r*(e+1)^e+1)>>>0;a+=Math.abs(o).toString(16).padStart(8,"0")}return a.slice(0,64)}stableStringify(t){return null===t||"object"!=typeof t?JSON.stringify(t):Array.isArray(t)?"["+t.map(this.stableStringify).join(",")+"]":"{"+Object.keys(t).sort().map(e=>JSON.stringify(e)+":"+this.stableStringify(t[e])).join(",")+"}"}updateProgress(){this.progress++;var e=Math.min(this.progress/this.totalSteps*100,100),t=document.getElementById("progress");t&&(t.style.width=e.toFixed(1)+"%")}safeGet(e,t="unavailable"){try{var r=e();return null!=r?r:t}catch{return t}}addParam(e,t,r="success",s="medium",a="other"){let o,n,i;var c;"success"===(c=r)||"error"===c||"low"===(c=s)||"medium"===c||"high"===c?(o=r??"success",n=s??"medium",i=a??"other"):(i=r??"other",o=s??"success",n=a??"medium"),this.allParams[e]=t,this.paramStatus[e]=o,this.paramEntropy[e]=n,this.paramCategory[e]=i,this.modules[i]||(this.modules[i]={}),this.modules[i][e]=t,this.updateProgress()}async getStableCanvasHash(){var e=document.createElement("canvas"),t=(e.width=240,e.height=180,e.getContext("2d",{willReadFrequently:!0}));t.fillStyle="#ffffff",t.fillRect(0,0,e.width,e.height),t.fillStyle="#e53935",t.fillRect(10,10,70,50),t.beginPath(),t.fillStyle="#43a047",t.arc(120,90,38,0,2*Math.PI),t.fill(),t.strokeStyle="#1e88e5",t.lineWidth=2,t.beginPath();for(let e=0;e<8*Math.PI;e+=.11){var r=120+2.2*e*Math.cos(e),s=90+2.2*e*Math.sin(e);0===e?t.moveTo(r,s):t.lineTo(r,s)}t.stroke();e=t.getImageData(0,0,e.width,e.height).data;return this.hashBytes(e)}getWebGLParams(){var e=document.createElement("canvas");let i=e.getContext("webgl")||e.getContext("experimental-webgl"),r=e.getContext("webgl2"),s={};if(i){s.webgl_supported=!0,s.webgl2_supported=!!r;["MAX_TEXTURE_SIZE","MAX_CUBE_MAP_TEXTURE_SIZE","MAX_RENDERBUFFER_SIZE","MAX_VIEWPORT_DIMS","DEPTH_BITS","STENCIL_BITS","RED_BITS","GREEN_BITS","BLUE_BITS","ALPHA_BITS","MAX_VERTEX_ATTRIBS","MAX_VERTEX_UNIFORM_VECTORS","MAX_FRAGMENT_UNIFORM_VECTORS","MAX_VARYING_VECTORS","MAX_VERTEX_TEXTURE_IMAGE_UNITS","MAX_COMBINED_TEXTURE_IMAGE_UNITS","MAX_TEXTURE_IMAGE_UNITS","ALIASED_LINE_WIDTH_RANGE","ALIASED_POINT_SIZE_RANGE"].forEach(e=>{try{var t=i.getParameter(i[e]);s[e]=Array.isArray(t)?t.join(","):t}catch{s[e]="error"}}),r&&["MAX_3D_TEXTURE_SIZE","MAX_ARRAY_TEXTURE_LAYERS","MAX_DRAW_BUFFERS","MAX_COLOR_ATTACHMENTS","MAX_SAMPLES"].forEach(e=>{try{var t=r.getParameter(r[e]);s[e]=Array.isArray(t)?t.join(","):t}catch{s[e]="error"}});try{var t=i.getExtension("WEBGL_debug_renderer_info");s.UNMASKED_VENDOR=t?i.getParameter(t.UNMASKED_VENDOR_WEBGL):"masked",s.UNMASKED_RENDERER=t?i.getParameter(t.UNMASKED_RENDERER_WEBGL):"masked"}catch{s.UNMASKED_VENDOR="error",s.UNMASKED_RENDERER="error"}try{var a=(i.getSupportedExtensions()||[]).slice().sort(),o=(s.WEBGL_EXTENSIONS_SORTED=a.join(","),{s3tc:!!i.getExtension("WEBGL_compressed_texture_s3tc")||!!i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||!!i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:!!i.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc1:!!i.getExtension("WEBGL_compressed_texture_etc1"),etc:!!i.getExtension("WEBGL_compressed_texture_etc"),pvrtc:!!i.getExtension("WEBGL_compressed_texture_pvrtc")||!!i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),astc:!!i.getExtension("WEBGL_compressed_texture_astc"),rgtc:!!i.getExtension("EXT_texture_compression_rgtc"),bptc:!!i.getExtension("EXT_texture_compression_bptc")});s.WEBGL_SUPPORTED_COMPRESSIONS=JSON.stringify(o)}catch(e){s.WEBGL_EXT_LIST_ERROR=e.message}try{let n={},e=[i.LOW_FLOAT,i.MEDIUM_FLOAT,i.HIGH_FLOAT,i.LOW_INT,i.MEDIUM_INT,i.HIGH_INT];[["vertex",i.VERTEX_SHADER],["fragment",i.FRAGMENT_SHADER]].forEach(([a,o])=>{e.forEach((e,t)=>{try{var r,s=i.getShaderPrecisionFormat(o,e);s&&(r=["lowFloat","mediumFloat","highFloat","lowInt","mediumInt","highInt"][t],n[a+"_"+r]=`${s.precision},${s.rangeMin},`+s.rangeMax)}catch{}})}),s.FLOAT_INT_PRECISION=JSON.stringify(n)}catch{}}else s.webgl_supported=!1;return s}async getGLRenderSHA(){let d=this;try{return await Promise.race([(async()=>{var e=document.createElement("canvas"),t=(e.width=64,e.height=64,e.getContext("webgl",{preserveDrawingBuffer:!0})||e.getContext("experimental-webgl"));if(!t)return"unavailable";var r,s=[];for(r of["precision highp float; void main(){ gl_FragColor=vec4(fract(gl_FragCoord.xy*0.007),0.5,1.0); }","precision mediump float; float f(vec2 p){return sin(p.x)*cos(p.y);} void main(){vec2 u=gl_FragCoord.xy/64.0;gl_FragColor=vec4(f(u*31.0));}"]){var a,o,n=t.createShader(t.VERTEX_SHADER),i=(t.shaderSource(n,"attribute vec2 p;void main(){gl_Position=vec4(p,0.0,1.0);}"),t.compileShader(n),t.createShader(t.FRAGMENT_SHADER)),c=(t.shaderSource(i,r),t.compileShader(i),t.createProgram());t.attachShader(c,n),t.attachShader(c,i),t.linkProgram(c),t.getProgramParameter(c,t.LINK_STATUS)&&(t.useProgram(c),a=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),t.STATIC_DRAW),o=t.getAttribLocation(c,"p"),t.enableVertexAttribArray(o),t.vertexAttribPointer(o,2,t.FLOAT,!1,0,0),t.viewport(0,0,64,64),t.drawArrays(t.TRIANGLE_STRIP,0,4),o=new Uint8Array(16384),t.readPixels(0,0,64,64,t.RGBA,t.UNSIGNED_BYTE,o),s.push(await d.hashBytes(o)),t.deleteBuffer(a),t.deleteProgram(c),t.deleteShader(n),t.deleteShader(i))}return e=(new TextEncoder).encode(s.join("|")),d.hashBytes(e)})(),new Promise(e=>setTimeout(()=>e("timeout_1000ms"),1e3))])}catch(e){return"error:"+e.message}}async getWebGL2CapsSHA(){try{let t=document.createElement("canvas").getContext("webgl2");if(!t)return"unavailable";let r={};["MAX_3D_TEXTURE_SIZE","MAX_ARRAY_TEXTURE_LAYERS","MAX_DRAW_BUFFERS","MAX_COLOR_ATTACHMENTS","MAX_SAMPLES","MAX_VERTEX_UNIFORM_BLOCKS","MAX_FRAGMENT_UNIFORM_BLOCKS","MAX_UNIFORM_BUFFER_BINDINGS"].forEach(e=>{try{r[e]=t.getParameter(t[e])}catch{r[e]="error"}});var e=(t.getSupportedExtensions()||[]).slice().sort();return await this.hashString(this.stableStringify({params:r,exts:e}))}catch(e){return"error:"+e.message}}async getWebGPUCapsSHA(){try{if(!("gpu"in navigator))return"unavailable";let t=await Promise.race([navigator.gpu.requestAdapter(),new Promise(e=>setTimeout(()=>e(null),1e3))]);if(!t)return"unavailable";var e=[...t.features].sort();let r={};return["maxBindGroups","maxTextureDimension2D","maxUniformBuffersPerShaderStage","maxSamplersPerShaderStage"].forEach(e=>{t.limits&&e in t.limits&&(r[e]=t.limits[e])}),await this.hashString(this.stableStringify({features:e,limits:r}))}catch(e){return"error:"+e.message}}async getFontsExtended(){try{var t=["Arial","Arial Black","Calibri","Cambria","Comic Sans MS","Consolas","Courier New","Georgia","Helvetica","Impact","Lucida Console","Monaco","Palatino","Tahoma","Times New Roman","Trebuchet MS","Verdana","Noto Sans","Noto Serif","Noto Sans Mono","DejaVu Sans","DejaVu Serif","DejaVu Sans Mono","Source Sans Pro","Source Serif Pro","Source Code Pro","Roboto","Roboto Slab","Roboto Mono","Open Sans","Inter","Fira Sans","Fira Mono","PT Sans","PT Serif","JetBrains Mono","SF Pro Display"];let e=["monospace","sans-serif","serif"],s="mmmmmmmmmmlli",a=document.createElement("canvas").getContext("2d"),o={},n=(e.forEach(e=>{a.font="72px "+e,o[e]=a.measureText(s).width}),[]);return t.forEach(t=>{let r=!1;e.forEach(e=>{a.font=`72px "${t}", `+e,a.measureText(s).width!==o[e]&&(r=!0)}),r&&n.push(t)}),n.sort(),{list:n,sha:await this.hashString(n.join("|"))}}catch{return{list:[],sha:"unavailable"}}}getStableMath(){return[()=>Math.sin(Math.PI/2),()=>Math.cos(0),()=>Math.tan(Math.PI/4),()=>Math.sqrt(2),()=>Math.E,()=>Math.LN2,()=>1,()=>Math.log(Math.exp(1)),()=>4*Math.atan2(1,1)].map(e=>Math.round(1e12*e())/1e12).join("|")}getEngine(){var e=Function.prototype.toString.toString(),t=["Array.from","Object.assign","Promise.resolve","Symbol.iterator","fetch","AbortController","BigInt","globalThis"].map(e=>{try{let t=window;return e.split(".").forEach(e=>t=t[e]),"function"==typeof t||"object"==typeof t?"1":"0"}catch{return"0"}}).join("");return{fnSigLen:e.length,methods:t}}getCSS(){let t=document.createElement("div");return["display:flex","display:grid","position:sticky","backdrop-filter:blur(1px)","clip-path:circle(50%)","writing-mode:vertical-lr","scroll-behavior:smooth","overscroll-behavior:contain"].map(e=>(t.style.cssText=e,0<t.style.length?"1":"0")).join("")}async getCrypto(){var e={};if(crypto&&crypto.subtle){var t,r=(new TextEncoder).encode("x"),s=[];for(t of["SHA-1","SHA-256","SHA-384","SHA-512"])try{await crypto.subtle.digest(t,r),s.push(t)}catch{}e.hashes=s.join("|");var a,o=[];for(a of[{name:"AES-GCM",length:256},{name:"AES-CBC",length:256},{name:"HMAC",hash:"SHA-256"}])try{a.name.startsWith("AES")?await crypto.subtle.generateKey(a,!1,["encrypt","decrypt"]):await crypto.subtle.generateKey(a,!1,["sign","verify"]),o.push(a.name)}catch{}e.keys=o.join("|")}else e.subtle=!1;return e}async getCryptoCapsExtendedSHA(){try{if(!crypto||!crypto.subtle)return"unavailable";var e={hkdf:!1,pbkdf2:!1,ecdh_p256:!1,import_formats:[],export_formats:[]},t=new TextEncoder;try{var r=await crypto.subtle.importKey("raw",t.encode("base"),{name:"HKDF"},!1,["deriveKey"]);await crypto.subtle.deriveKey({name:"HKDF",hash:"SHA-256",salt:t.encode("s"),info:t.encode("i")},r,{name:"AES-GCM",length:128},!1,["encrypt","decrypt"])&&(e.hkdf=!0)}catch{}try{var s=await crypto.subtle.importKey("raw",t.encode("password"),{name:"PBKDF2"},!1,["deriveKey"]);await crypto.subtle.deriveKey({name:"PBKDF2",hash:"SHA-256",salt:t.encode("salt"),iterations:1e3},s,{name:"AES-GCM",length:128},!1,["encrypt","decrypt"])&&(e.pbkdf2=!0)}catch{}try{var a=await crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveBits"]),o=await crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveBits"]);await crypto.subtle.deriveBits({name:"ECDH",public:o.publicKey},a.privateKey,128)&&(e.ecdh_p256=!0);try{await crypto.subtle.exportKey("spki",a.publicKey)&&e.export_formats.push("spki")}catch{}try{await crypto.subtle.exportKey("pkcs8",a.privateKey)&&e.export_formats.push("pkcs8")}catch{}try{await crypto.subtle.importKey("spki",await crypto.subtle.exportKey("spki",a.publicKey),{name:"ECDH",namedCurve:"P-256"},!0,[])&&e.import_formats.push("spki")}catch{}try{await crypto.subtle.importKey("pkcs8",await crypto.subtle.exportKey("pkcs8",a.privateKey),{name:"ECDH",namedCurve:"P-256"},!0,["deriveBits"])&&e.import_formats.push("pkcs8")}catch{}}catch{}return await this.hashString(this.stableStringify(e))}catch(e){return"error:"+e.message}}addCodecsSupport(){try{let s=document.createElement("video");var e={codec_h264:'video/mp4; codecs="avc1.42E01E"',codec_vp8:'video/webm; codecs="vp8"',codec_vp9:'video/webm; codecs="vp09.00.10.08"',codec_av1:'video/mp4; codecs="av01.0.00M.08"',codec_aac:'audio/mp4; codecs="mp4a.40.2"',codec_opus:'audio/webm; codecs="opus"',codec_vorbis:'audio/ogg; codecs="vorbis"'};let a=[];Object.entries(e).forEach(([e,t])=>{var r=s.canPlayType(t),r="probably"===r||"maybe"===r;this.addParam(e,r,"media","success","medium"),r&&a.push(t)}),this.addParam("video_codecs",a.join(","),"media","success","medium")}catch(e){this.addParam("video_codecs_error",e.message,"media","error","medium")}}async addMediaCapabilities(){try{if("mediaCapabilities"in navigator){var e,t=[];for(e of[{type:"file",video:{contentType:'video/mp4; codecs="avc1.42E01E"',width:1920,height:1080,bitrate:4e6,framerate:30}},{type:"file",video:{contentType:'video/webm; codecs="vp8"',width:1920,height:1080,bitrate:4e6,framerate:30}},{type:"file",video:{contentType:'video/webm; codecs="vp09.00.10.08"',width:1920,height:1080,bitrate:4e6,framerate:30}},{type:"file",video:{contentType:'video/mp4; codecs="av01.0.05M.08"',width:1920,height:1080,bitrate:4e6,framerate:30}},{type:"file",audio:{contentType:'audio/mp4; codecs="mp4a.40.2"',channels:2,bitrate:128e3,samplerate:44100}},{type:"file",audio:{contentType:'audio/webm; codecs="opus"',channels:2,bitrate:128e3,samplerate:48e3}},{type:"file",audio:{contentType:'audio/ogg; codecs="vorbis"',channels:2,bitrate:128e3,samplerate:44100}}]){var r=await navigator.mediaCapabilities.decodingInfo(e);t.push({k:(e.video||e.audio).contentType,s:!!r.supported,pe:!!r.powerEfficient,sm:!!r.smooth})}t.sort((e,t)=>e.k<t.k?-1:1),this.addParam("media_capabilities_profile",JSON.stringify(t),"media","success","medium")}else this.addParam("media_capabilities","unavailable","media","error","low")}catch(e){this.addParam("media_capabilities_error",e.message,"media","error","low")}}addBrowserSystem(){var e=window.devicePixelRatio||1,t=Math.round(screen.width*e),r=Math.round(screen.height*e);this.addParam("screen_physical_resolution",t+"x"+r,"display","success","high"),this.addParam("device_pixel_ratio",e,"display","success","high"),this.addParam("screen_color_depth",screen.colorDepth,"display","success","high"),this.addParam("screen_pixel_depth",screen.pixelDepth||"unavailable","display","success","medium"),this.addParam("platform",navigator.platform,"system","success","high"),this.addParam("languages",(navigator.languages||[]).join(","),"system","success","medium"),this.addParam("timezone",Intl.DateTimeFormat().resolvedOptions().timeZone,"system","success","high"),this.addParam("timezone_offset",(new Date).getTimezoneOffset(),"system","success","high"),this.addParam("intl_calendar",this.safeGet(()=>Intl.DateTimeFormat().resolvedOptions().calendar),"system","success","low"),this.addParam("intl_numbering_system",this.safeGet(()=>Intl.DateTimeFormat().resolvedOptions().numberingSystem),"system","success","low"),this.addParam("hardware_concurrency",navigator.hardwareConcurrency||"unavailable","hardware","success","high"),"deviceMemory"in navigator&&this.addParam("device_memory",navigator.deviceMemory,"hardware","success","medium"),this.addParam("max_touch_points",navigator.maxTouchPoints||0,"hardware","success","medium"),this.addParam("touch_support","ontouchstart"in window,"hardware","success","low"),this.addParam("app_name",navigator.appName||"unavailable","browser","success","low"),this.addParam("product",navigator.product||"unavailable","browser","success","low"),this.addParam("webdriver",!!navigator.webdriver,"browser","success","high"),this.addParam("pdf_viewer_enabled",navigator.pdfViewerEnabled||"unavailable","browser","success","low"),this.addParam("webassembly_support","undefined"!=typeof WebAssembly,"browser","success","low"),this.addParam("webrtc_support","undefined"!=typeof RTCPeerConnection,"browser","success","low"),this.addParam("websocket_support","undefined"!=typeof WebSocket,"browser","success","low"),this.addParam("service_worker_support","serviceWorker"in navigator,"browser","success","low"),this.addParam("notification","Notification"in window,"browser","success","low"),this.addParam("push_messaging","PushManager"in window,"browser","success","low"),this.addParam("geolocation","geolocation"in navigator,"browser","success","low"),this.addParam("speech_synthesis","speechSynthesis"in window,"browser","success","low"),this.addParam("local_storage","undefined"!=typeof localStorage,"browser","success","low"),this.addParam("session_storage","undefined"!=typeof sessionStorage,"browser","success","low"),this.addParam("indexed_db","undefined"!=typeof indexedDB,"browser","success","low"),this.addParam("storage_quota_api","storage"in navigator&&"estimate"in navigator.storage,"browser","success","low"),this.addParam("prefers_reduced_motion",window.matchMedia("(prefers-reduced-motion: reduce)").matches,"display","success","low"),this.addParam("prefers_color_scheme_dark",window.matchMedia("(prefers-color-scheme: dark)").matches,"display","success","low"),this.addParam("prefers_color_scheme_light",window.matchMedia("(prefers-color-scheme: light)").matches,"display","success","low"),this.addParam("forced_colors",window.matchMedia("(forced-colors: active)").matches,"display","success","low"),this.addParam("inverted_colors",window.matchMedia("(inverted-colors: inverted)").matches,"display","success","low"),this.addParam("prefers_contrast_high",window.matchMedia("(prefers-contrast: high)").matches,"display","success","low"),this.addParam("any_hover",window.matchMedia("(any-hover: hover)").matches,"display","success","low"),this.addParam("any_pointer_coarse",window.matchMedia("(any-pointer: coarse)").matches,"display","success","low"),this.addParam("any_pointer_fine",window.matchMedia("(any-pointer: fine)").matches,"display","success","low")}getSelectedMap(){let r={},s=(Object.keys(this.allParams).forEach(e=>{var t=document.getElementById("cb-"+e);t&&t.checked&&(r[e]=this.allParams[e])}),!1);return Object.keys(this.allParams).forEach(e=>{var t=document.getElementById("cb-"+e);t&&(s=!0),t&&t.checked&&(r[e]=this.allParams[e])}),s||Object.keys(this.allParams).forEach(e=>{"success"===this.paramStatus[e]&&(r[e]=this.allParams[e])}),r}async buildModuleHashes(r){let s={};Object.keys(r).forEach(e=>{var t=this.paramCategory[e]||"other";(s[t]||(s[t]={}))[e]=r[e]});var e,t={};for(e of Object.keys(s).sort())t[e]=await this.hashString(this.stableStringify(s[e]));return t}async updateHash(){var e,t=this.getSelectedMap(),r={};for(e of Object.keys(t).sort())r[e]=t[e];var s,a=await this.buildModuleHashes(r),o={};for(s of Object.keys(a).sort())o[s]=a[s];return{f_hash:await this.hashString(this.stableStringify(o)),module_hashes:await this.mapModuleHashesKeys(o,this.keyMap)}}mapModuleHashesKeys(e,t){var r,s={};for(r in e)s[t[r]||r]=e[r];return s}async collectFingerprint(){try{var e=window.devicePixelRatio||1,t=Math.round(screen.width*e),r=Math.round(screen.height*e),s=(this.addParam("screen_physical_resolution",t+"x"+r,"display","success","high"),this.addParam("device_pixel_ratio",e,"display","success","high"),this.addParam("screen_color_depth",screen.colorDepth,"display","success","high"),this.addParam("screen_pixel_depth",screen.pixelDepth||"unavailable","display","success","medium"),this.addParam("platform",navigator.platform,"system","success","high"),this.addParam("languages",(navigator.languages||[]).join(","),"system","success","medium"),this.addParam("timezone",Intl.DateTimeFormat().resolvedOptions().timeZone,"system","success","high"),this.addParam("timezone_offset",(new Date).getTimezoneOffset(),"system","success","high"),this.addParam("intl_calendar",this.safeGet(()=>Intl.DateTimeFormat().resolvedOptions().calendar),"system","success","low"),this.addParam("intl_numbering_system",this.safeGet(()=>Intl.DateTimeFormat().resolvedOptions().numberingSystem),"system","success","low"),this.addParam("hardware_concurrency",navigator.hardwareConcurrency||"unavailable","hardware","success","high"),"deviceMemory"in navigator&&this.addParam("device_memory",navigator.deviceMemory,"hardware","success","medium"),this.addParam("max_touch_points",navigator.maxTouchPoints||0,"hardware","success","medium"),this.addParam("touch_support","ontouchstart"in window,"hardware","success","low"),this.addParam("canvas_fingerprint",await this.getStableCanvasHash(),"canvas","success","high"),this.getWebGLParams()),a=(Object.entries(s).forEach(([e,t])=>{var r=["UNMASKED_VENDOR","UNMASKED_RENDERER","MAX_TEXTURE_SIZE","WEBGL_EXTENSIONS_SORTED"].includes(e)?"high":"medium";this.addParam(e,t,"webgl","error"===t?"error":"success",r)}),this.addParam("gl_render_sha",await this.getGLRenderSHA(),"webgl","success","high"),this.addParam("webgl2_caps_sha",await this.getWebGL2CapsSHA(),"webgl","success","high"),this.addParam("webgpu_caps_sha",await this.getWebGPUCapsSHA(),"webgpu","success","high"),this.addParam("enhanced_math_precision",this.getStableMath(),"enhanced_math","success","high"),this.getEngine()),o=(this.addParam("enhanced_js_fnSigLen",a.fnSigLen,"enhanced_engine","success","high"),this.addParam("enhanced_method_support",a.methods,"enhanced_engine","success","high"),this.addParam("enhanced_css_support",this.getCSS(),"enhanced_css","success","medium"),await this.getCrypto()),n=(this.addParam("enhanced_crypto_hash_algorithms",o.hashes||"","enhanced_crypto","success","medium"),this.addParam("enhanced_crypto_key_algorithms",o.keys||"","enhanced_crypto","success","medium"),this.addParam("crypto_caps_sha",await this.getCryptoCapsExtendedSHA(),"enhanced_crypto","success","high"),this.addParam("js_heap_size_limit",this.safeGet(()=>performance&&performance.memory&&performance.memory.jsHeapSizeLimit),"system","success","high"),!(!window.WebAssembly||"object"!=typeof WebAssembly)),i=!(!window.WebAssembly||"undefined"==typeof SharedArrayBuffer||!0!==self.crossOriginIsolated);this.addParam("wasm_simd_support",n,"runtime","success","high"),this.addParam("wasm_threads_support",i,"runtime","success","high");try{var c,d=window.AudioContext||window.webkitAudioContext;d?(c=new d,this.addParam("audio_base_latency",c.baseLatency||"na","media","success","medium"),c&&"function"==typeof c.close&&await c.close()):this.addParam("audio_base_latency","unavailable","media","error","medium")}catch(e){this.addParam("audio_base_latency","error","media","error","medium")}try{var l=document.createElement("canvas").getContext("webgl")||document.createElement("canvas").getContext("experimental-webgl");if(l){var _=(l.getSupportedExtensions()||[]).slice().sort(),h=(this.addParam("webgl_extensions_sorted",_.join(","),"webgl","success","high"),{s3tc:!!l.getExtension("WEBGL_compressed_texture_s3tc")||!!l.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||!!l.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:!!l.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc1:!!l.getExtension("WEBGL_compressed_texture_etc1"),etc:!!l.getExtension("WEBGL_compressed_texture_etc"),pvrtc:!!l.getExtension("WEBGL_compressed_texture_pvrtc")||!!l.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),astc:!!l.getExtension("WEBGL_compressed_texture_astc"),rgtc:!!l.getExtension("EXT_texture_compression_rgtc"),bptc:!!l.getExtension("EXT_texture_compression_bptc")});this.addParam("webgl_supported_compressions",JSON.stringify(h),"webgl","success","high");try{var u=l.getExtension("WEBGL_debug_renderer_info"),m=u?l.getParameter(u.UNMASKED_RENDERER_WEBGL):"unavailable";this.addParam("webgl_unmasked_renderer",m||"unavailable","webgl","success","high")}catch{this.addParam("webgl_unmasked_renderer","error","webgl","error","high")}}else this.addParam("webgl_extensions_sorted","unavailable","webgl","error","high"),this.addParam("webgl_supported_compressions","unavailable","webgl","error","high"),this.addParam("webgl_unmasked_renderer","unavailable","webgl","error","high")}catch{this.addParam("webgl_extensions_sorted","error","webgl","error","high"),this.addParam("webgl_supported_compressions","error","webgl","error","high"),this.addParam("webgl_unmasked_renderer","error","webgl","error","high")}this.addCodecsSupport(),await this.addMediaCapabilities(),this.addBrowserSystem(),this.recommended=["screen_physical_resolution","device_pixel_ratio","screen_color_depth","platform","hardware_concurrency","max_touch_points","timezone","canvas_fingerprint","UNMASKED_VENDOR","UNMASKED_RENDERER","MAX_TEXTURE_SIZE","WEBGL_EXTENSIONS_SORTED","webgl_supported_compressions","webgl_extensions_sorted","webgl_unmasked_renderer","enhanced_math_precision","enhanced_js_fnSigLen","enhanced_method_support","enhanced_css_support","enhanced_crypto_hash_algorithms","crypto_caps_sha","js_heap_size_limit","wasm_simd_support","wasm_threads_support","audio_base_latency","gl_render_sha","webgl2_caps_sha","webgpu_caps_sha"]}catch(e){console.error(e),this.addParam("main_error",String(e&&e.message?e.message:e),"system","error","high")}finally{return this.updateHash()}}}class d{constructor(){this.storageKey="bot_detector_token_ip_version",this.defaultRecord={event_token:null,response_ip_version:"undefined",ipv6_reached:0,ipv4_reached:0,ipv_candidates:[],error:"",sent:0},this.moderateUrlVFour="https://fd-v4.cleantalk.org/api3.0/frontend_data",this.moderateUrlVSix="https://fd-v6.cleantalk.org/api3.0/frontend_data",this.ipvFourWebRTCAvailable=!0,this.ipvSixWebRTCAvailable=!1,this.ipvCandidates=[]}getStorage(){return e.get(this.storageKey)||[]}setStorage(t){e.set(this.storageKey,t)}recordExists(e,t){return e.some(e=>e.event_token===t)}updateReachedStatus(e,t){4===t?e.ipv4_reached=1:6===t&&(e.ipv6_reached=1),e.response_ip_version=t}processResponse(e){var t,r=this.getStorage();this.recordExists(r,e.event_token)||(t={...this.defaultRecord,event_token:e.event_token},e.hasOwnProperty("ip_version")&&this.updateReachedStatus(t,e.ip_version),r.push(t),this.setStorage(r))}determineUpdateType(e){return 0===e.ipv4_reached?{type:4,url:this.moderateUrlVFour,token:e.event_token}:0===e.ipv6_reached?{type:6,url:this.moderateUrlVSix,token:e.event_token}:null}async sendUpdateRequest(t){var r=botDetectorCreateClientInfo();try{var s={event_token:e.isSet("bot_detector_event_token")&&e.isAlive("bot_detector_event_token")?e.get("bot_detector_event_token"):null,js_event:"ipVersionCheck",page_url:window.location.href,data:r},o=await a.send("frontend_data",s,t);return this.processResponse(o),!1}catch(e){return{urlToReach:t,error:e.toString()}}}updateRecordStatus(e,r,s,a){return e.map(e=>{var t;return e.event_token===r?(t={...e},4===s?t.ipv4_reached=a?-1:1:6===s&&(t.ipv6_reached=a?-1:1),t.ipv_candidates=this.ipvCandidates,a&&(t.error=JSON.stringify(a)),t):e})}async processIPVersionChecks(){var t=this.getStorage();if(t.length)for(var r of t){r=this.determineUpdateType(r);if(r){var{type:s,url:a,token:o}=r;let e={urlToReach:a,error:"Protocol version is unreachable for v".type};(6!==r.type||this.rtcChekReady&&this.ipvSixWebRTCAvailable)&&(e=await this.sendUpdateRequest(a));r=this.updateRecordStatus(t,o,s,e);this.setStorage(r);break}}}detectWebRTCIPVersion(){let t=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]}),r=!1,s=!1,a=(t.createDataChannel(""),t.createOffer().then(e=>t.setLocalDescription(e)).catch(e=>{this.finalizeResults(!1,!1)}),setTimeout(()=>{t.onicecandidate=null,this.finalizeResults(r,s)},3e3));t.onicecandidate=e=>{e.candidate?(e=e.candidate.candidate,this.ipvCandidates.push(e),this.shouldIgnoreCandidate(e)||(!r&&e.includes(".")&&(r=this.isPublicIPv4(e)),e=e.replace("candidate:",""),!s&&e.includes(":")&&(s=this.isPublicIPv6(e)),r&&s&&(clearTimeout(a),t.onicecandidate=null,this.finalizeResults(!0,!0)))):(clearTimeout(a),this.finalizeResults(r,s))}}finalizeResults(e,t){this.ipvFourWebRTCAvailable=e,this.ipvSixWebRTCAvailable=t,this.rtcChekReady=!0}shouldIgnoreCandidate(e){return e.includes(".local")||e.includes("typ host")||e.includes("127.0.0.1")||e.includes("::1")}isPublicIPv4(e){e=e.match(/([0-9]+\.[0-9]+\.[0-9]+\.[0-9]+)/);return e&&!this.isPrivateIP(e[1])}isPublicIPv6(e){return!e.includes("fe80:")&&!e.includes("::1")}isPrivateIP(e){e=e.split(".").map(e=>parseInt(e,10));return 10===e[0]||172===e[0]&&16<=e[1]&&e[1]<=31||192===e[0]&&168===e[1]||169===e[0]&&254===e[1]}}class e{static maxLifetime=600;static get(e,t){void 0===t&&(t="value");e=localStorage.getItem(e);if(null!==e)try{var r=JSON.parse(e);return r.hasOwnProperty(t)?r[t]:r}catch(e){return new Error(e)}return!1}static set(e,t){t={value:t,timestamp:Math.floor((new Date).getTime()/1e3)};localStorage.setItem(e,JSON.stringify(t))}static isAlive(e,t){return void 0===t&&(t=this.maxLifetime),this.get(e,"timestamp")+t>Math.floor((new Date).getTime()/1e3)}static isSet(e){return null!==localStorage.getItem(e)}static delete(e){localStorage.removeItem(e)}}class f{constructor(){this.logLsName="ct_bot_detector_frontend_data_log",this.logsLimit=10,this.getInstance(),this.enabled=!1}writeLog(e){e.frontend_data=this.filterFrontendData(e.frontend_data),e.responder_data=this.filterResponderData(e.responder_data),e.forms_processed=this.filterFormsProcessed(e.forms_processed),this.instance.records.push(e),this.instance.log_last_update=Math.floor((new Date).getTime()/1e3),this.saveInstance()}getInstance(){this.dropInstance(),this.instance={log_start:Math.floor((new Date).getTime()/1e3),log_last_update:"",records:[]}}validateInstance(e){return"object"==typeof e&&!(!(e.hasOwnProperty("log_start")&&e.hasOwnProperty("log_last_update")&&e.hasOwnProperty("records"))||e.records.length>this.logsLimit)&&Array.isArray(e.records)}dropInstance(){e.delete(this.logLsName)}saveInstance(){this.validateInstance(this.instance)&&e.set(this.logLsName,JSON.stringify(this.instance))}getRecordInstance(){return{success:!1,timestamp_on_send:null,timestamp_on_received:null,frontend_data:{event_token:"",js_event:""},responder_data:{host_name:"",headers:"",new_event_token:""},forms_processed:{forms_count:0,forms_list:[],forms_handling_error:""},error:""}}filterFrontendData(e){return e={event_token:e.hasOwnProperty("event_token")?e.event_token:"",js_event:e.hasOwnProperty("js_event")?e.js_event:""}}filterResponderData(e){return e={host_name:e.hasOwnProperty("host_name")?e.host_name:"",headers:e.hasOwnProperty("headers")?e.headers:"",new_event_token:e.hasOwnProperty("new_event_token")?e.new_event_token:""}}filterFormsProcessed(e){return e={forms_count:e.hasOwnProperty("forms_count")?e.forms_count:0,forms_list:e.hasOwnProperty("forms_list")?e.forms_list:[],forms_handling_error:e.hasOwnProperty("forms_handling_error")?e.forms_handling_error:""}}}class g{static keysObj={key_esc_pressed:!1,key_backspace_pressed:!1,key_capslock_pressed:!1,key_shift_ctrl_pressed:!1,key_shift_alt_pressed:!1,key_mobile_capslock_pressed:!1};collectSpecialKeys(e){let t=!1;"Escape"===e.key&&(g.keysObj.key_esc_pressed=!0,t=!0),"Backspace"===e.key&&(g.keysObj.key_backspace_pressed=!0,t=!0),"CapsLock"===e.key&&(g.keysObj.key_capslock_pressed=!0,t=!0),"Shift"===e.key&&e.ctrlKey&&(g.keysObj.key_shift_ctrl_pressed=!0,t=!0),"Shift"===e.key&&e.altKey&&(g.keysObj.key_shift_alt_pressed=!0,t=!0);var r=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);return"input"===e.type&&r&&e.target&&e.target.value&&(r=e.target.value.slice(-1))&&r===r.toUpperCase()&&r!==r.toLowerCase()&&r.match(/[A-Z\u0400-\u042F\u0401]/u)&&(g.keysObj.key_mobile_capslock_pressed=!0,t=!0),t}}class h{fieldData={fieldName:"",fieldType:"",isAutocompleteExist:!1,isAutocomplete:!1,label:"",isUseBuffer:!1,speedDelta:0,firstKeyTimestamp:0,lastKeyTimestamp:0,lastDelta:0,countOfKey:0};fields=document.querySelectorAll("input[type=text], input[type=email], textarea");data=[];gatheringFields(){Array.prototype.slice.call(this.fields).forEach((e,t)=>{var r=Object.assign({},this.fieldData);e.name&&(r.fieldName=e.name),e.nodeName&&(r.fieldType=e.nodeName),e.autocomplete&&"off"!==e.autocomplete&&(r.isAutocompleteExist=!0,r.isAutocomplete=e.autocomplete),e.labels&&0<e.labels.length&&(r.label=e.labels[0].innerText),this.data.push(Object.assign({},r))})}setListeners(){this.fields.forEach((e,t)=>{e.addEventListener("paste",e=>{e&&"object"==typeof e&&e instanceof ClipboardEvent?e.clipboardData.getData("text"):void 0!==window.clipboardData&&window.clipboardData.getData("text"),this.data[t].isUseBuffer=!0})}),this.fields.forEach((e,s)=>{e.addEventListener("input",e=>{this.data[s].countOfKey++;var t,r=+new Date;1===this.data[s].countOfKey?(this.data[s].lastKeyTimestamp=r,this.data[s].firstKeyTimestamp=r):(t=r-this.data[s].lastKeyTimestamp,2===this.data[s].countOfKey?(this.data[s].lastKeyTimestamp=r,this.data[s].lastDelta=t):2<this.data[s].countOfKey&&(this.data[s].speedDelta+=Math.abs(this.data[s].lastDelta-t),this.data[s].lastKeyTimestamp=r,this.data[s].lastDelta=t))})})}}function isFromExcludedFromEventTokenField(e,t){if(void 0!==e.attributes.method&&"get"===e.method)return!0;let r=!1;try{var s=getAllDescendantNodes(e),a={selfAttributes:void 0!==e.attributes&&e.attributes,children:void 0!==s&&s!==[]&&s,parent:void 0!==e.parentNode&&e.parentNode.attributes};if(void 0!==t)for(var o in t){var n=t[o];if("object"==typeof n&&n.hasOwnProperty("signs_to_check")){var i=!(!n.signs_to_check.hasOwnProperty("form_attributes")||""===n.signs_to_check.form_attributes)&&n.signs_to_check.form_attributes,c=!(!n.signs_to_check.hasOwnProperty("form_parent_attributes")||""===n.signs_to_check.form_parent_attributes)&&n.signs_to_check.form_parent_attributes,d=!(!n.signs_to_check.hasOwnProperty("form_children_attributes")||""===n.signs_to_check.form_children_attributes)&&n.signs_to_check.form_children_attributes;if(i&&a.selfAttributes)r=checkAttributesExclusions(a.selfAttributes,i);else if(c&&a.parent)r=checkAttributesExclusions(a.parent,c);else if(d&&a.children)for(var l in a.children){if(r)break;void 0===a.children[l]||isChildExcludedCtServiceField(a.children[l])||(r=checkAttributesExclusions(a.children[l].attributes,d))}if(r)return n}}}catch(e){console.warn("CleanTalk Bot Detector exclusion check error: "+e.message)}return r}function getPregMatchBool(e,t){if("string"==typeof e&&"string"==typeof t){if(""===e||""===t)return!1;if(e.match(t))return!0}return!1}function checkAttributesExclusions(e,t){let r=!1;for(var s in e){if(r)break;"object"==typeof e[s]&&null!==e[s]&&"string"==typeof e[s].nodeValue&&(r=getPregMatchBool(e[s].nodeValue,t))}return r}function getAllDescendantNodes(e,t=[]){t.push(...e.childNodes);for(var r of e.childNodes)getAllDescendantNodes(r,t);return t}function isChildExcludedCtServiceField(e){return"string"==typeof e.id&&(-1!==e.id.indexOf("apbct__email_id")||-1!==e.id.indexOf("apbct_event_id")||-1!==e.id.indexOf("apbct_visible_fields")||-1!==e.id.indexOf("ct_checkjs"))||"string"==typeof e.name&&-1!==e.name.indexOf("ct_no_cookie_hidden_field")}function botDetectorOnAnimationStart(e){("onautofillstart"===e.animationName?botDetectorAutocomplete:botDetectorCancelAutocomplete)(e.target)}function botDetectorOnInput(e){("insertReplacementText"!==e.inputType&&"data"in e?botDetectorCancelAutocomplete:botDetectorAutocomplete)(e.target)}function botDetectorAutocomplete(e){var t;e.hasAttribute("autocompleted")||(e.setAttribute("autocompleted",""),t=new window.CustomEvent("onautocomplete",{bubbles:!0,cancelable:!0,detail:null}),e.dispatchEvent(t))||(e.value="")}function botDetectorCancelAutocomplete(e){e.hasAttribute("autocompleted")&&(e.removeAttribute("autocompleted"),e.dispatchEvent(new window.CustomEvent("onautocomplete",{bubbles:!0,cancelable:!1,detail:null})))}let t="1.1.58",r=(new Date).getTime(),s=[],o=!0,n=0,i=[],l=5e3,_,u={send_on_cron:!0,send_on_stop_collect:!1,last_data_length:0},m={last_data_length:0},p=new f,y=new b,v=new d;function botDetectorInit(){v.detectWebRTCIPVersion(),botDetectorGetFingerprint().then(t=>{e.set("bot_detector_f_hash",t)});[["bot_detector_pointer_data",0],["bot_detector_screen_info",botDetectorGetScreenInfo()],["bot_detector_headless",navigator.webdriver],["bot_detector_list_keys_pressed",g.keysObj]].forEach(t=>{e.set(t[0],t[1])});var t=e.get("bot_detector_page_hits")?e.get("bot_detector_page_hits"):0,t=(e.set("bot_detector_page_hits",parseInt(t)+1),e.get("bot_detector_user_agent")?e.get("bot_detector_user_agent"):window.navigator.userAgent);e.set("bot_detector_user_agent",t),e.set("bot_detector_token_ip_version",[]),_=botDetectorGetFormsExclusions(),botDetectorStartFormsListeners(),botDetectorSetBrowserCookieSupportFlag(),botDetectorSetWebGlSupportFlag(),botDetectorSetReferrers(),y.runService(),botDetectorFrontendData("DOMContentLoaded"),setInterval(()=>{e.isSet("bot_detector_event_token")&&!e.isAlive("bot_detector_event_token")&&botDetectorFrontendData("automaticRefresh")},3e3);document.typoData=new h,document.typoData.gatheringFields(),document.typoData.setListeners(),document.botDetectorSpecialKeys=new g}function botDetectorGetFormsExclusions(){let e=[];try{e=(e="object"==typeof ctPublic&&!0===ctPublic.hasOwnProperty("bot_detector_forms_excluded"))?JSON.parse(atob(ctPublic.bot_detector_forms_excluded)):[]}catch{}return e}function botDetectorStartFormsListeners(){var t=document.forms;if(0<t.length)for(let e=0;e<t.length;e++)t[e].addEventListener("submit",()=>{botDetectorFrontendData("submit")});botDetectorStartFieldsListening(t)}function botDetectorAttachEventHandler(e,t,r){"function"==typeof window.addEventListener?e.addEventListener(t,r):e.attachEvent(t,r)}function botDetectorRemoveEventHandler(e,t,r){"function"==typeof window.removeEventListener?e.removeEventListener(t,r):e.detachEvent(t,r)}function botDetectorGetScreenInfo(){return{fullWidth:document.documentElement.scrollWidth,fullHeight:Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight),visibleWidth:document.documentElement.clientWidth,visibleHeight:document.documentElement.clientHeight}}function botDetectorMouseStopData(){u.send_on_stop_collect=!0,window.removeEventListener("mousemove",botDetectorGetMouseData)}function botDetectorGetMouseData(t){o&&(s.push([Math.round(t.clientY),Math.round(t.clientX),Math.round((new Date).getTime()-r)]),o=!1,new Promise(e=>{setTimeout(()=>e(),150)}).then(()=>{e.set("bot_detector_pointer_data",s),n++,o=!0}),150<=n)&&botDetectorMouseStopData()}function botDetectorSetHasScrolled(){e.isSet("bot_detector_has_scrolled")&&e.isAlive("bot_detector_has_scrolled")&&e.get("bot_detector_has_scrolled")||(e.set("bot_detector_has_scrolled",!0),botDetectorFrontendData("scrolled"))}let w=150,E=window.scrollY||document.documentElement.scrollTop,S=(new Date).getTime(),k=S,P=0,D=0,T=[],C=["timestamp","scrollTop","scrollSpeed","scrollDistance","scrollPercent","scrollEndCount","scrollDelay","scrollCount"];function botDetectorCollectScrollingParameters(){var t=window.scrollY||document.documentElement.scrollTop,r=(new Date).getTime(),s=document.documentElement.scrollHeight||document.body.scrollHeight,a=window.innerHeight||document.documentElement.clientHeight,o=t/(s-a)*100,n=Math.abs(t-E),i=n/((r-S)/1e3),c=(r-k)/1e3;E=t,S=r,k=r,s<=t+a&&P++,D++,T.push([r,t,i,n,o,P,c,D]),T.length>w&&(T=T.slice(T.length-w)),e.set("bot_detector_scrolling_additional",T)}function botDetectorSendScrollingParameters(t){var r,s=e.isSet("bot_detector_scrolling_additional")?e.get("bot_detector_scrolling_additional","value"):0;if(0!==s&&void 0!==s.length&&m.last_data_length!==s.length)return(r=botDetectorCreateClientInfo()).scrolling_additional=s,botDetectorSendClientInfoToCloud(r,t,customUrl=null),m.last_data_length=s.length,!0;return!1}function botDetectorSetMouseMoved(){e.isSet("bot_detector_mouse_moved")&&e.isAlive("bot_detector_mouse_moved")&&e.get("bot_detector_mouse_moved")||(e.set("bot_detector_mouse_moved",!0),botDetectorFrontendData("mousemoved"))}function botDetectorStartFieldsListening(t){if((!e.isSet("bot_detector_has_key_up")&&!e.get("bot_detector_has_key_up")||!e.isSet("bot_detector_has_input_focused")&&!e.get("bot_detector_has_input_focused"))&&0<t.length)for(let e=0;e<t.length;e++){var r=t[e].querySelectorAll("input,textarea");for(let e=0;e<r.length;e++)"hidden"!==r[e].type&&(i.push(r[e]),botDetectorAttachEventHandler(r[e],"focus",A),botDetectorAttachEventHandler(r[e],"keyup",R))}}function botDetectorStopFieldsListening(t,r){if(void 0!==i&&0<i.length)for(let e=0;e<i.length;e++)botDetectorRemoveEventHandler(i[e],t,r)}T.push(C);let A=function(){e.isSet("bot_detector_has_input_focused")&&e.get("bot_detector_has_input_focused")||e.set("bot_detector_has_input_focused",!0),botDetectorStopFieldsListening("focus",A)},R=function(){e.isSet("bot_detector_has_key_up")&&e.get("bot_detector_has_key_up")||e.set("bot_detector_has_key_up",!0),botDetectorStopFieldsListening("keyup",R)};function botDetectorSetReferrers(){e.set("bot_detector_referrer",window.location.href),e.set("bot_detector_referrer_previous",document.referrer)}function botDetectorSetBrowserCookieSupportFlag(){if(!e.isSet("bot_detector_browser_supports_cookies")||!e.isAlive("bot_detector_browser_supports_cookies")||!e.get("bot_detector_browser_supports_cookies")){let t=navigator.cookieEnabled;if(!t)try{document.cookie="testcookie="+encodeURIComponent("testcookievalue")+"; path=/",t=-1!==document.cookie.indexOf("testcookie")}catch(e){t=!1}e.set("bot_detector_browser_supports_cookies",t)}}function botDetectorSetWebGlSupportFlag(){var t=document.createElement("canvas");t.getContext("webgl")||t.getContext("experimental-webgl")?e.set("bot_detector_webgl_support",!0):e.set("bot_detector_webgl_support",!1)}function botDetectorCreateClientInfo(){return{agent:"bot_detector_"+t,timestamp:Math.floor((new Date).getTime()/1e3)}}function botDetectorFrontendData(t){var r=botDetectorCreateClientInfo();e.isSet("bot_detector_list_keys_pressed")&&(r.bot_detector_list_keys_pressed=e.get("bot_detector_list_keys_pressed")),e.isSet("bot_detector_headless")&&(r.headless=e.get("bot_detector_headless")),e.isSet("bot_detector_page_hits")&&(r.page_hits=e.get("bot_detector_page_hits")),e.isSet("bot_detector_has_scrolled")&&(r.has_scrolled=e.get("bot_detector_has_scrolled")),e.isSet("bot_detector_mouse_moved")&&(r.mouse_moved=e.get("bot_detector_mouse_moved")),e.isSet("bot_detector_pointer_data")&&(r.pointer_data=e.get("bot_detector_pointer_data")),e.isSet("bot_detector_screen_info")&&(r.screen_info=e.get("bot_detector_screen_info")),e.isSet("bot_detector_user_agent")&&(r.user_agent=e.get("bot_detector_user_agent")),e.isSet("bot_detector_referrer")&&(r.REFFERRER=e.get("bot_detector_referrer")),e.isSet("bot_detector_referrer_previous")&&(r.REFFERRER_PREVIOUS=e.get("bot_detector_referrer_previous")),e.isSet("bot_detector_browser_supports_cookies")&&(r.cookies_enabled=e.get("bot_detector_browser_supports_cookies")),e.isSet("bot_detector_has_input_focused")&&(r.has_input_focused=e.get("bot_detector_has_input_focused")),e.isSet("bot_detector_has_key_up")&&(r.has_key_up=e.get("bot_detector_has_key_up")),e.isSet("bot_detector_webgl_support")&&(r.webgl=e.get("bot_detector_webgl_support")),e.isSet("bot_detector_scrolling_additional")&&(r.scrolling_additional=e.get("bot_detector_scrolling_additional")),"submit"===t&&document.typoData&&(r.typo=document.typoData.data),botDetectorSendClientInfoToCloud(r,t)}function botDetectorSendClientInfoToCloud(t,r,s=null){r={event_token:e.isSet("bot_detector_event_token")&&e.isAlive("bot_detector_event_token")?e.get("bot_detector_event_token"):null,js_event:r,page_url:window.location.href,data:t};let o=p.getRecordInstance();o.frontend_data=r,o.timestamp_on_send=Math.floor((new Date).getTime()/1e3),1<Object.keys(t).length&&a.send("frontend_data",r,s).then(t=>{o.responder_data.headers=t.getAllResponseHeaders(),o.timestamp_on_received=Math.floor((new Date).getTime()/1e3);try{var r,s,a=JSON.parse(t.response);"SUCCESS"===a.data.operation_status?(e.set("bot_detector_event_token",a.event_token),v.processResponse(a),o.forms_processed=setEventTokenFieldsToForms(a.event_token),o.responder_data.new_event_token=a.event_token,o.success=!0,r=new CustomEvent("botDetectorEventTokenUpdated",{detail:{eventToken:a.event_token,timestamp:Date.now()}}),window.dispatchEvent(r)):(s="API error: "+a.error_no+" - "+a.error_message,console.log(s),o.error=s),o.responder_data.host_name=a.hasOwnProperty("host_name")?a.host_name:"not provided"}catch(e){o.error=e.toString(),console.log("Can not parse the response. "+e.toString())}}).catch(e=>{console.log(e.toString()),o.error=e.toString()}).finally(()=>{!0===p.enabled&&p.writeLog(o)})}function setEventTokenFieldsToForms(r){var t,s={forms_count:0,forms_list:[],forms_handling_error:""};if("string"!=typeof r||64!==r.length)t="API error: no valid bot detector event token found in server response.",console.warn(t),s.forms_handling_error=t;else{var a=document.forms;if(e.delete("ct_bot_detector_form_exclusion"),0<a.length)for(let t=0;t<a.length;t++){var o=isFromExcludedFromEventTokenField(a[t],_);if(!1!==o){let t;try{t=JSON.stringify(o)}catch{t=JSON.stringify("JSON error")}e.set("ct_bot_detector_form_exclusion",t)}else if(setEventTokenFormField(a[t],r,t)){s.forms_count++;var n=a[t].attributes,i={};for(let e=0;e<n.length;e++)n[e].name&&n[e].value&&(i[n[e].name]=n[e].value);s.forms_list.push(i)}}}return s}function setEventTokenFormField(e,t,r){if(void 0!==e.elements.ct_bot_detector_event_token)return e.elements.ct_bot_detector_event_token.value=t,!1;var s=document.createElement("input");s.setAttribute("type","hidden");let a=100+Math.floor(899*Math.random());return a=a.toString()+r.toString().substring(-1),s.setAttribute("id","ct_bot_detector_event_token_"+a),s.setAttribute("name","ct_bot_detector_event_token"),s.value=t,e.append(s),!0}async function botDetectorGetFingerprint(){var t=new c,r={f_hash:"",module_hashes:"",error_msg:"",success:!1,sent:!1};try{var e=await t.collectFingerprint();r.f_hash=e.f_hash||"",r.module_hashes=e.module_hashes||"",r.success=!!e}catch(e){r.error_msg=e&&e.message?e.message:String(e),t&&"function"==typeof t.addParam&&t.addParam("main_error",r.error_msg,"error","high","system")}return r}function botDetectorCollectSpecialKeys(t){document.botDetectorSpecialKeys&&document.botDetectorSpecialKeys.collectSpecialKeys(t)&&e.set("bot_detector_list_keys_pressed",g.keysObj)}"loading"!==document.readyState?botDetectorInit():document.addEventListener("DOMContentLoaded",botDetectorInit),window.addEventListener("mousemove",botDetectorGetMouseData),window.addEventListener("mousemove",botDetectorSetMouseMoved),window.addEventListener("scroll",botDetectorSetHasScrolled),window.addEventListener("scroll",botDetectorCollectScrollingParameters),window.addEventListener("animationstart",botDetectorOnAnimationStart,!0),window.addEventListener("input",botDetectorOnInput,!0),window.addEventListener("keydown",botDetectorCollectSpecialKeys),window.addEventListener("input",botDetectorCollectSpecialKeys)}